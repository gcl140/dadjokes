{% extends "discussion/base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block title %}
Edit Profile
{% endblock %}

{% block content %}
{% load widget_tweaks %}

<div id="profile-modal" class="fixed inset-0 z-50 ">
    <!-- Overlay -->
    <div class="modal-overlay absolute inset-0 bg-black bg-opacity-70 backdrop-blur-sm transition-opacity"></div>

    <!-- Modal Container -->
    <div class="flex items-center justify-center min-h-screen p-4">
        <!-- Modal Content -->
        <div class="relative bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-gray-700">
            <!-- Close Button -->
            <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <i class="fas fa-times text-2xl"></i>
            </button>

            <!-- Modal Header -->
            <div class="p-6 border-b border-gray-700">
                <h2 class="text-2xl font-bold text-white flex items-center">
                    <i class="fas fa-user-edit mr-3 text-maroon"></i>Edit Profile
                </h2>
            </div>

            <!-- Modal Body -->
            <div class="p-6">
                <form id="profile-form" method="POST" enctype="multipart/form-data" action="{% url 'edit_profile' %}">
                    {% csrf_token %}

                    <!-- Profile Picture Upload -->
                    <div class="mb-6 flex flex-col items-center">
                        <div class="relative mb-4">
                            {% if form.instance.profile_picture %}
                                <img id="profile-picture-preview" src="{{ form.instance.profile_picture.url }}" 
                                     class="w-32 h-32 rounded-full object-cover border-4 border-gray-700 shadow-lg">
                            {% else %}
                                <div id="profile-picture-preview" class="w-32 h-32 rounded-full bg-gray-700 flex items-center justify-center border-4 border-gray-700 shadow-lg">
                                    <i class="fas fa-user text-4xl text-gray-400"></i>
                                </div>
                            {% endif %}
                        </div>
                        <label for="profile-picture-input" class="file-upload-label bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors cursor-pointer">
                            <i class="fas fa-camera mr-2"></i> Change Photo
                        </label>
                        {{ form.profile_picture|add_class:"hidden"|attr:"id:profile-picture-input" }}
                    </div>

                    <!-- Form Fields -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-gray-300 mb-2 font-medium">
                                <i class="fas fa-user mr-2 text-maroon"></i>First Name
                            </label>
                            {% render_field form.first_name class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition" placeholder="Your first name" %}
                        </div>
                        <div>
                            <label class="block text-gray-300 mb-2 font-medium">
                                <i class="fas fa-user mr-2 text-maroon"></i>Last Name
                            </label>
                            {% render_field form.last_name class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition" placeholder="Your last name" %}
                        </div>
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-gray-300 mb-2 font-medium">
                            <i class="fas fa-venus-mars mr-2 text-maroon"></i>Gender
                        </label>
                        {% render_field form.gender class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition" placeholder="Your gender" %}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <div class="mt-4">
                        <label class="block text-gray-300 mb-2 font-medium">
                            <i class="fas fa-envelope mr-2 text-maroon"></i>Email
                        </label>
                        {% render_field form.email class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition" placeholder="your@email.com" %}
                    </div>
                    
                    <div class="mt-4">
                        <label class="block text-gray-300 mb-2 font-medium">
                            <i class="fas fa-phone mr-2 text-maroon"></i>Phone Number
                        </label>
                        {% render_field form.telephone class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition" placeholder="+255123456789" %}
                        <p class="text-xs text-gray-400 mt-1"><i class="fas fa-info-circle mr-1"></i>Format: +255123456789</p>
                    </div>
                </div>

                    <div class="mt-4">
                        <label class="block text-gray-300 mb-2 font-medium">
                            <i class="fas fa-book-open mr-2 text-maroon"></i>Bio
                        </label>
                        {% render_field form.bio class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition h-32" placeholder="Tell us about yourself..."|attr:"rows:4" %}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                        <div class="mt-4">
                        <label class="block text-gray-300 mb-2 font-medium">
                            <i class="fas fa-graduation-cap mr-2 text-maroon"></i>School/Institution
                        </label>
                        {% render_field form.school class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition" placeholder="Your school or institution" %}
                    </div>

                        <div class="mt-4">
                        <label class="block text-gray-300 mb-2 font-medium">
                            <i class="fas fa-calendar mr-2 text-maroon"></i>Graduation Year
                        </label>
                        {% render_field form.grad_year class="w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-maroon focus:border-transparent transition" placeholder="Graduation Year" %}
                    </div>
                    </div>

                    <div class="mt-4">
                        <label class="block text-gray-300 mb-2 font-medium">
                            <i class="fab fa-instagram mr-2 text-maroon"></i>Instagram
                        </label>
                        <div class="flex items-center bg-gray-700 border border-gray-600 rounded-lg overflow-hidden focus-within:ring-2 focus-within:ring-maroon focus-within:border-transparent">
                            <span class="px-3 text-gray-400 bg-gray-800">instagram.com/</span>
                            {% render_field form.instagram_username class="flex-1 px-3 py-2 bg-gray-700 text-white focus:outline-none" placeholder="username" %}
                        </div>
                    </div>


                    <div class="mt-8 flex justify-end space-x-3">
                        <button type="button" onclick="closeModal()" class="px-6 py-2 border border-gray-600 text-gray-300 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-times mr-2"></i>Cancel
                        </button>
                        <button type="submit" class="px-6 py-2 bg-maroon text-white rounded-lg hover:bg-gray-700 transition-colors flex items-center">
                            <i class="fas fa-save mr-2"></i>Save Changes
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Profile Picture Preview
    document.getElementById('profile-picture-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.getElementById('profile-picture-preview');
                if (preview.tagName === 'IMG') {
                    preview.src = event.target.result;
                } else {
                    const newImg = document.createElement('img');
                    newImg.id = 'profile-picture-preview';
                    newImg.className = 'w-32 h-32 rounded-full object-cover border-4 border-gray-700 shadow-lg';
                    newImg.src = event.target.result;
                    preview.parentNode.replaceChild(newImg, preview);
                }
            }
            reader.readAsDataURL(file);
        }
    });
</script>


<script>
    // Modal Functions
    function openModal() {
        const modal = document.getElementById('profile-modal');
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal() {
        const modal = document.getElementById('profile-modal');
        modal.classList.add('hidden');
        window.history.back(); // Reload to reflect changes
        document.body.style.overflow = 'auto';
    }
    
    // Profile Picture Preview
    document.getElementById('profile-picture-input').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                const preview = document.getElementById('profile-picture-preview');
                if (preview.tagName === 'IMG') {
                    preview.src = event.target.result;
                } else {
                    // If it's the placeholder div, replace with image
                    const newImg = document.createElement('img');
                    newImg.id = 'profile-picture-preview';
                    newImg.className = 'profile-picture-preview';
                    newImg.src = event.target.result;
                    preview.parentNode.replaceChild(newImg, preview);
                }
            }
            reader.readAsDataURL(file);
        }
    });
    
    // Close modal when clicking outside
    {% comment %} document.querySelector('.modal-overlay').addEventListener('click', closeModal); {% endcomment %}
    
    // Prevent modal close when clicking inside modal content
    document.querySelector('.modal-content').addEventListener('click', function(e) {
        e.stopPropagation();
    });
</script>
{% endblock %}