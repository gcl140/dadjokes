{% extends "discussion/base2.html" %}
{% load static %}
{% block title %}@{{viewing_user.nickname}}{% endblock %}

{% block content %}
<main class="">
    <div class="max-w-4xl mx-auto bg-gray-900 rounded-lg shadow-lg overflow-hidden">
        <!-- Profile Header -->
        <div class="p-6 text-white" style="background-image: linear-gradient(to right, #c4ad2bff, {{ color }});">
            <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-6">
                <!-- Profile Picture -->
                <div class="relative">
                    {% if viewing_user.profile_picture %}
                        <img src="{{ viewing_user.profile_picture.url }}" alt="Profile" class="w-20 h-20 sm:w-24 sm:h-24 rounded-full border-4 border-white/80 object-cover">
                    {% else %}
                        <div class="w-20 h-20 sm:w-24 sm:h-24 rounded-full border-4 border-white/80 bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-user text-3xl sm:text-4xl text-gray-500"></i>
                        </div>
                    {% endif %}
                </div>
                
                <!-- User Info -->
                <div class="flex-1 w-full">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <div>
                            <h1 class="text-xl sm:text-2xl font-bold">{{ viewing_user.get_full_name|default:viewing_user.nickname }}</h1>
                            <p class="text-blue-100/90 text-sm sm:text-base">@{{ viewing_user.nickname }}</p>
                        </div>
                        {% if is_own_profile %}
                            <a href="{% url 'edit_profile' %}" class="bg-maroon text-gray-600 px-3 py-1.5 sm:px-4 sm:py-2 rounded-md font-medium hover:bg-white transition-all shadow-sm whitespace-nowrap text-sm sm:text-base">
                                <i class="fas fa-edit mr-1 sm:mr-2"></i>Edit Profile
                            </a>
                        {% else %}
                            <button class="bg-white/90 text-gray-600 px-3 py-1.5 sm:px-4 sm:py-2 rounded-md font-medium hover:bg-white transition-all shadow-sm whitespace-nowrap text-sm sm:text-base">
                                <a href="mailto:{{ viewing_user.email }}" class="flex items-center">
                                    <i class="fas fa-envelope mr-1 sm:mr-2"></i>Email
                                </a>
                            </button>
                        {% endif %}
                    </div>
                    
                    <div class="mt-3 sm:mt-4 flex flex-wrap gap-3 text-sm sm:text-base">
                        <div class="flex items-center bg-maroon opacity-70 px-2 py-1 rounded-full">
                            <i class="fas fa-graduation-cap mr-1 sm:mr-2 text-sm"></i>
                            <span>
                            {{ viewing_user.school|default:"Earth" }}
                            '{% if viewing_user.grad_year %}{{ viewing_user.grad_year|stringformat:"s"|slice:"-2:" }}{% endif %}
                            </span>

                        </div>

                        <div class="flex items-center bg-maroon opacity-70 px-2 py-1 rounded-full">
                            <i class="fas fa-venus-mars mr-1 sm:mr-2 text-sm"></i>
                            <span>{{ viewing_user.gender }}</span>
                        </div>

                        {% if viewing_user.instagram_username %}
                        <div class="flex items-center bg-maroon opacity-70 px-2 py-1 rounded-full">
                            <i class="fab fa-instagram mr-1 sm:mr-2 text-sm"></i>
                            <a href="https://www.instagram.com/{{ viewing_user.instagram_username }}" target="_blank" class="hover:underline">{{ viewing_user.instagram_username|truncatechars:15 }}</a>
                        </div>
                        {% endif %}
                        <div class="flex items-center bg-maroon opacity-70 px-2 py-1 rounded-full">
                            <i class="fas fa-calendar-alt mr-1 sm:mr-2 text-sm"></i>
                            <span>Joined {{ viewing_user.date_joined|date:"M Y" }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Profile Body -->
        <div class="p-4 sm:p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 sm:gap-6">
                <!-- Left Column -->
                <div class="md:col-span-2 space-y-4 sm:space-y-6">
                    <!-- About Section -->
                    <div class="bg-gray-800 p-4 sm:p-5 rounded-lg">
                        <h2 class="text-lg sm:text-xl font-semibold mb-3 pb-2 border-b border-gray-700 flex items-center">
                            <i class="fas fa-user-circle mr-2 text-gray-400"></i>About
                        </h2>
                        <p class="text-gray-300/90 text-sm sm:text-base">
                            {{ viewing_user.bio|default:"This user hasn't added a bio yet." }}
                        </p>
                    </div>
                    
                    <!-- Contact Info -->
                    <div class="bg-gray-800 p-4 sm:p-5 rounded-lg">
                        <h2 class="text-lg sm:text-xl font-semibold mb-3 pb-2 border-b border-gray-700 flex items-center">
                            <i class="fas fa-envelope-open mr-2 text-gray-400"></i>Contact
                        </h2>
                        <div class="space-y-2">
                            <div class="flex items-center">
                                <i class="fas fa-envelope mr-3 text-gray-400 w-5 text-center"></i>
                                <a href="mailto:{{ viewing_user.email }}" class="text-gray-400 hover:underline text-sm sm:text-base">
                                    {{ viewing_user.email }}
                                </a>
                            </div>
                            {% if viewing_user.telephone %}
                            <div class="flex items-center">
                                <i class="fas fa-phone mr-3 text-gray-400 w-5 text-center"></i>
                                <a href="tel:{{ viewing_user.telephone }}" class="text-gray-400 hover:underline text-sm sm:text-base">
                                    {{ viewing_user.telephone }}
                                </a>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-gray-800 p-4 sm:p-5 rounded-lg">
                        <h2 class="text-lg sm:text-xl font-semibold mb-3 pb-2 border-b border-gray-700 flex items-center">
                            <i class="fas fa-clock mr-2 text-gray-400"></i>Recent Activity
                        </h2>
                        {% if not recent_posts and not recent_replies and not recent_child_replies %}
                        <p class="text-gray-300 text-sm sm:text-base">No recent activity found.</p>
                        {% else %}
                        <div class="space-y-3">
                            {% for post in recent_posts %}
                            <div class="border-l-4 border-blue-500 pl-3 py-2 bg-gray-700/50 rounded-r">
                                <div class="flex justify-between items-center text-xs sm:text-sm text-gray-400 mb-1 p-2">
                                    <span class="flex items-center">
                                        <i class="fas fa-question-circle mr-1"></i> Asked question
                                    </span>
                                    <span class="text-gray-400 text-xs italic">{{ post.created_at|timesince }} ago</span>
                                </div>
                                <a href="{% url 'post_detail' post.id %}" class="font-medium text-white hover:text-blue-400 text-sm sm:text-base block">
                                    {{ post.title }}
                                </a>
                                <div class="text-xs sm:text-sm text-gray-400 mt-1">{{ post.content|truncatewords:15 }}</div>
                            </div>
                            {% endfor %}

                            {% for reply in recent_replies %}
                            <div class="border-l-4 border-green-500 pl-3 py-2 bg-gray-700/50 rounded-r">
                                <div class="flex justify-between items-center text-xs sm:text-sm text-gray-400 mb-1 p-2">
                                    <span class="flex items-center">
                                        <i class="fas fa-reply mr-1"></i> Replied
                                    </span>
                                    <span class="text-gray-400 text-xs italic">{{ reply.created_at|timesince }} ago</span>
                                </div>
                                <a href="{% url 'post_detail' reply.post.id %}" class="font-medium text-white hover:text-green-400 text-sm sm:text-base block">
                                    {{ reply.post.title }}
                                </a>
                                <div class="text-xs sm:text-sm text-gray-400 mt-1">{{ reply.content|truncatewords:15 }}</div>
                            </div>
                            {% endfor %}
                            
                            {% for child_reply in recent_child_replies %}
                            <div class="border-l-4 border-yellow-500 pl-3 py-2 bg-gray-700/50 rounded-r">
                                <div class="flex justify-between items-center text-xs sm:text-sm text-gray-400 mb-1 p-2">
                                    <span class="flex items-center">
                                        <i class="fas fa-comments mr-1"></i> Replied to reply
                                    </span>
                                    <span class="text-gray-400 text-xs italic">{{ child_reply.created_at|timesince }} ago</span>
                                </div>
                                <div class="font-medium text-gray-400 text-xs sm:text-sm">
                                    @<a href="{% url 'view_profile' child_reply.replyier.id %}" class="hover:underline font-bold text-maroon">{{ child_reply.replyier.nickname }}
                                    </a>
                                    [{{ child_reply.content|truncatechars:15 }}]
                                </div>
                                <div class="text-xs sm:text-sm text-gray-400 mt-1">
                                    {{ child_reply.content|truncatewords:10 }}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Right Column -->
                <div class="space-y-4 sm:space-y-6">
                    <!-- Stats -->
                    <div class="bg-gray-800 p-4 sm:p-5 rounded-lg">
                        <h3 class="text-lg sm:text-xl font-semibold mb-3 pb-2 border-b border-gray-700 flex items-center">
                            <i class="fas fa-chart-bar mr-2 text-gray-400"></i>Stats
                        </h3>
                        <div class="grid grid-cols-2 gap-3 sm:gap-4">
                            <div class="bg-gray-700 p-3 rounded-lg text-center hover:bg-gray-600 transition">
                                <div class="text-2xl sm:text-3xl font-bold text-blue-400">{{ viewing_user.questions_asked|default:"0" }}</div>
                                <div class="md:block hidden text-xs sm:text-sm text-gray-300">Qns</div>
                                <div class="md:hidden block text-xs sm:text-sm text-gray-300">Questions</div>
                            </div>
                            <div class="bg-gray-700 p-3 rounded-lg text-center hover:bg-gray-600 transition">
                                <div class="text-2xl sm:text-3xl font-bold text-green-400">{{ viewing_user.answers_posted|default:"0" }}</div>
                                <div class="md:block hidden text-xs sm:text-sm text-gray-300">Ans</div>
                                <div class="md:hidden block text-xs sm:text-sm text-gray-300">Answers</div>
                            </div>
                            <div class="bg-gray-700 p-3 rounded-lg text-center hover:bg-gray-600 transition">
                                <div class="text-2xl sm:text-3xl font-bold text-purple-400">{{ viewing_user.reputation|default:"0" }}</div>
                                <div class="md:block hidden text-xs sm:text-sm text-gray-300">Rep</div>
                                <div class="md:hidden block text-xs sm:text-sm text-gray-300">Reputation</div>
                            </div>
                            <div class="bg-gray-700 p-3 rounded-lg text-center hover:bg-gray-600 transition">
                                <div class="text-2xl sm:text-3xl font-bold text-yellow-400">{{ viewing_user.badges|length|default:"0" }}</div>
                                <div class="md:block hidden text-xs sm:text-sm text-gray-300">Bdg</div>
                                <div class="md:hidden block text-xs sm:text-sm text-gray-300">Badges</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Badges -->
                    <div class="bg-gray-800 p-4 sm:p-5 rounded-lg">
                        <h3 class="text-lg sm:text-xl font-semibold mb-3 pb-2 border-b border-gray-700 flex items-center">
                            <i class="fas fa-award mr-2 text-gray-400"></i>Badges
                        </h3>
                        <div class="space-y-2">
                            {% for badge in viewing_user.badges %}
                            <div class="flex items-center px-3 py-2 rounded-lg hover:bg-gray-600 transition">
                                {% if badge == 'Gold' %}
                                    <i class="fas fa-trophy text-yellow-400 mr-2"></i>
                                {% elif badge == 'Silver' %}
                                    <i class="fas fa-medal text-gray-300 mr-2"></i>
                                {% else %}
                                    <i class="fas fa-certificate text-amber-500 mr-2"></i>
                                    {% endif %}
                                    <span class="text-amber-500">{{ badge }} Contributor</span>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    
                </div>
            </div>
        </div>
    </div>
</main>

{% comment %} <button onclick="openModal()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
    <i class="fas fa-edit mr-2"></i>Edit Profile
</button>

<!-- Include this at the bottom of your template -->
{% include 'yuzzaz/partials/edit_profile_modal.html' %} {% endcomment %}

{% endblock %}